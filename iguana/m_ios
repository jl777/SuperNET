set -x

CC="$(xcrun --sdk iphoneos --find clang) -isysroot $(xcrun --sdk iphoneos --show-sdk-path)  -arch arm64 -arch armv7 -arch armv7s"

git pull

cd secp256k1; ./m_ios; cd ..

echo Compile rest ..
$CC -v -Wno-deprecated -O2 -c *.c ../basilisk/basilisk.c ../gecko/gecko.c ../datachain/datachain.c
$CC -v -Wno-deprecated -c main.c iguana777.c iguana_bundles.c ../basilisk/basilisk.c

echo Compile the end
$CC -v -Wno-deprecated -o ../agents/iguana -O2 *.o ../ios/lib/libssl.a ../ios/lib/libcrypto.a ../agents/libcrypto777.a  -L $(xcrun --sdk iphoneos --show-sdk-path)/usr/lib -I ../ios/include ../ios/lib/libcurl.a -framework Foundation -lz -framework Security -lm